Grammar:		DataElement 5.0
Namespace:		shr.medication
Description:	"The medication domain contains definitions related to medications taken, or not taken, by the person of record, both currently and in the past."
Uses:  			shr.core, shr.base, shr.entity, shr.encounter, shr.procedure

/* Taking out for now since Plan has not been defined
EntryElement:	MedicationRegimen   // Definitional 
Concept:		MTH#C0237125
Description:	"Defines a specific application of over-the-counter and prescribed/recommended medications and infusions to meet guidelines for therapeutic action, safety, and schedule."
1..*			MedicationUsePlanned
*/

Element:		Dosage
Concept:		MTH#C0178602
Description:	"The dosage of the medication. The data structure is flexible and can describe a dosage prescribed, administered, or reported."
0..1			DoseAmount
0..1			TimingOfDoses
0..1			AsNeededIndicator
0..1			DosageInstructionsText
0..*			AdditionalDosageInstruction from http://hl7.org/fhir/ValueSet/additional-instruction-codes
0..1			RouteIntoBody from http://hl7.org/fhir/ValueSet/route-codes
0..1			DosageMethod from http://hl7.org/fhir/ValueSet/administration-method-codes
0..1			DosageBodySite
0..1			MaximumDosePerTimePeriod

		Element:		DoseAmount
		Concept:		TBD
		Description:	"The amount of medication taken per dose, as a quantity or range. Relative dose (e.g., per kg body weight or surface area) are indicated by specifying appropriate units (e.g., mg/kg or mg/m2 etc)."
		Value:			SimpleQuantity or Range

		Element:		TimingOfDoses
		Concept:		TBD
		Description:	"When doses of medication should be administered."
		Value:			Timing

		Element:		AsNeededIndicator
		Concept:		MTH#C1883728
		Description:	"Indicates the pre-condition under which the drug or intervention should be used."
		Value:			boolean or CodeableConcept could be from http://hl7.org/fhir/ValueSet/medication-as-needed-reason
		
		Element:		DosageInstructionsText
		Concept:		TBD
		Description:	"The directions (signetur) on the drug prescription or dispensing record."
		Value:			string

		Element:		AdditionalDosageInstruction
		Concept:		MTH#C1644714
		Description:	"Supplemental instructions - e.g. 'with meals'."
		Value:			CodeableConcept

		Element:		DosageMethod
		Concept:		MTH#C1547585
		Description:	"Technique for administering medication."
		Value:			CodeableConcept

		Element:		DosageBodySite
		Concept:		MTH#C0229986
		Description:	"The anatomic site at which medical intervention is applied."
		Value:			AnatomicalLocationPrecoordinated

		Element:		MaximumDosePerTimePeriod
		Concept:		TBD
		Description:	"The maximum amount of a medication to be taken in a given period of time (e.g., no more than x in any 24-hour period)"
		Value:			Ratio


EntryElement:	MedicationStatement
Based on:		ActionPerformed
Concept:		SCT#416608005 "Drug therapy (procedure)"  // TODO: investigate whether we need a new code or use a drug concept.
Description:	"A record of the use of a medication. If the medication is given as part of a course of treatment, the PartOf attribute should refer to the CourseOfTreatment."
//				SourceOfInformation value is type AnyPersonOrOrganization 
1..1			Medication
0..1			Dosage
0..1			Category should be from http://hl7.org/fhir/ValueSet/medication-statement-category
				Status from http://hl7.org/fhir/ValueSet/medication-statement-status
0..0			Method // because of Dosage.Method				
0..1			Reason // DSTU 2 change (upper card imposed by DSTU 2)

EntryElement:	MedicationAdministered
Based on:		ActionPerformed
Concept:		TBD
Description:	"A record of the use of a medication. If the medication is given as part of a course of treatment, the PartOf attribute should refer to the CourseOfTreatment."
//				SourceOfInformation value is type AnyPersonOrOrganization
1..1			Medication
0..1			Dosage
0..1			Category should be from http://hl7.org/fhir/ValueSet/medication-statement-category
				Status from http://hl7.org/fhir/ValueSet/medication-admin-status
0..0			Method // because of Dosage.Method
0..1			Participation
				Participation.Participant is type FHIRMedicationAdministrationParticipant  //  DSTU 2 change (max cardinality = 1)
0..0			Participation.ParticipationType				
				RelatedRequest value is type ref(MedicationRequested)		
		
		Element:		FHIRMedicationAdministrationParticipant
		Based on:		Participant
		Description:	"Constraints participants to classes that are accepted by FHIR as actors in procedures in STU 3."
		Value:			ref(Practitioner) or ref(Patient) or ref(RelatedPerson) or ref(Device)


EntryElement:	MedicationAdherence  
Based on:		CodedNonLaboratoryObservation
Concept:		MTH#C2364172
Description:	"Information on the ability and cooperation of the patient in taking medicine or supplement as recommended or prescribed. This includes correct timing, dosage, and frequency. The SpecificFocusOfFinding must reference the medication via a code, MedicationRequest, or MedicationStatement.
Modeling note: MedicationAdherence could be attached to MedicationStatement directly as an extension, but modeling as an observation avoids creating an extension and allows this observation to be made at any time."
				FindingResult from QualitativeFrequencyVS
				FindingTopicCode is MTH#C2364172
1..1			SpecificFocusOfFinding  // TODO: constrain type!
				NonIndependentFinding
includes 		0..* MedicationNonAdherenceReason

		Element:	 	MedicationNonAdherenceReason
		Based on:		CodedNonIndependentFinding
		Description:	"Reason that patient did not adhere to a medication regimen."
						FindingResult from MedicationNonAdherenceReasonVS
						FindingTopicCode is TBD#TBD

EntryElement:	MedicationNotAdministered
Based on:		ActionNotPerformed
Concept:		TBD
Description:	"A record of a medication NOT used. Although usually not required, a medication not used is sometimes reported when deviating from normal expectation or care plan."
1..1			Medication
0..1			Category should be from http://hl7.org/fhir/ValueSet/medication-statement-category			
				Reason from MedicationNotUsedReasonVS
				
EntryElement:	MedicationRequested
Based on:		ActionRequested
Concept:		TBD
Description:	"An order for a medication to be dispensed and instructions for use."
				Status //from http://hl7.org/fhir/ValueSet/medication-request-status  DSTU 2 change (incompatible required value sets)
				PriorityRank from http://hl7.org/fhir/ValueSet/medication-request-priority
1..1			Medication
0..1			Dosage
0..1			NumberOfRefillsAllowed
0..1			QuantityPerDispense
0..1			SupplyDuration
0..1			SubstitutionAllowed
0..1			Reason // DSTU 2 change (upper cardinality of 1 imposed by DSTU 2)

	Element:		NumberOfRefillsAllowed
	Concept:		TBD
	Description:	"The maximum number of times the dispense can be repeated. For medication dispense, this integer does NOT include the original order dispense. This means that if an order indicates dispense 30 tablets plus 3 repeats, then the order can be dispensed a total of 4 times and the patient can receive a total of 120 tablets."
	Value:			positiveInt  // should be unsignedInt, but that causes a mapping error in FHIR 3.0

	Element:		QuantityPerDispense
	Concept:		TBD
	Description:	"The amount that is to be dispensed for one fill."
	Value:			SimpleQuantity

	Element:		SupplyDuration
	Concept:		TBD
	Description:	"Identifies the period time over which the supplied product is expected to be used, or the length of time the dispense is expected to last."
	Value: 			Duration

	Element:		SubstitutionAllowed
	Concept:		TBD
	Description:	"Whether substitution is allowed or not."
	Value:			boolean


EntryElement:	MedicationNotPrescribed
Based on:		ActionRequestedAgainst
Concept:		TBD
Description:	"A record of a medication NOT being prescribed. Recorded only when deviating from the normal expectation, care plan, or standard of care."
1..1			Medication
				Reason from MedicationNotUsedReasonVS

Element:		MedicationDispensed
Based on:		ActionPerformed
Concept:		TBD
Description:	"Indicates that a medication product has been dispensed for a named person/patient. This includes a description of the medication product (supply) provided and the instructions for administering the medication. The medication dispense is the result of a pharmacy system responding to a medication order."
// Attributes from FHIR needed

					
Element:		MedicationNotDispensed
Based on:		ActionNotPerformed
Concept:		TBD
Description:	"Indicates that a medication product has NOT been dispensed for a named person/patient. This may be a result of the timing out of an order or detection of pharmacist of duplicate prescription or other reason."
// Attributes needed


EntryElement:	MedicationChange
Based on:		ActionPerformed
Concept:		MTH#C0554834
Description:	"Description of a modification or change of a medication or dosage, whether the change is a dose change, switch to a new medication, or discontinuation."
0..*			MedicationBeforeChange   //might be more than one
0..*			MedicationAfterChange
				Reason from MedicationChangeReasonVS   // why was the medication changed?

		Element:		MedicationBeforeChange
		Concept:		TBD
		Description:	"The medication taken, prior to the change."
		Value:			ref(MedicationRequested) or ref(MedicationStatement) or ref(MedicationAdministered)
		
		Element:		MedicationAfterChange
		Concept:		TBD
		Description:	"The medication taken, prior to the change."
		Value:			ref(MedicationRequested) or ref(MedicationStatement) or ref(MedicationAdministered)

