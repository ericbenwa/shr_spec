Grammar:		DataElement 5.0
Namespace:		shr.base
Description:	"Contains the SHR Entry definition -- the metadata added to any independent item in the SHR."
Uses:			shr.core, shr.entity, shr.encounter


Abstract Element:	NonIndependentFinding
Based on:			InformationItem
Description:		"A finding that does not or cannot stand alone, or a component of another finding."
// should we have finding protocol, finding precondition, finding question, finding data, finding interpretation?
// how do we handle normal? (physical exam normal)
// exclusions? (diabetes excluded)
0..1			FindingResult
1..1			FindingTopicCode  // Question, test name, or condition
0..1			ExceptionValue
0..1			ReferenceRange  // included here only because components can have reference range which usually needs to be explicitly zeroed out. If it is not part of DataElement, it will appear in FHIR Profiles.
// TODO:  0..1			Interpretation

		Element:		FindingResult
		Description:	"The value or result of a test, evaluation, or judgment, for example, a systolic blood pressure, or if a condition or body structure is present or absent."
		Value:			CodeableConcept or Quantity or string or Range or Ratio or time or dateTime or TimePeriod
		// exclude boolean because FHIR STU3 component doesn't include it, although Observation does; exclude Media because it is not present in FHIR v4

		Element:		FindingTopicCode
		Description:	"A code describing what the finding concerns, such as a condition, lab test, property, or an item. In an observation, the code represents the 'question': the aspect or property being observed or measured. In an existence assertion, the code represents the type of event, condition, or phenomenon that is being asserted to exist or not exist. The topic code is not the result of the evaluation, which is found in the FindingResult. "
		Value:			CodeableConcept

		Element:		ExceptionValue
		Concept:		TBD
		Description:	"Reason that a value associated with a test or other finding is missing."
		Value:			CodeableConcept from http://hl7.org/fhir/ValueSet/data-absent-reason if covered

		Element:		ReferenceRange
		Concept:		MTH#C0883335
		Description:	"The usual or acceptable range for a test result."
		0..1			Range   // TODO: align this with FHIR
		0..1			Type from http://hl7.org/fhir/ValueSet/referencerange-meaning if covered
		0..1			ApplicableSubpopulation
		0..1			ApplicableAgeRange
		
				Element:	ApplicableSubpopulation
				Concept:	MTH#C0039309 "Target Population"
				Description:	"Codes to indicate the target population this reference range applies to. For example, a reference range may be based on the normal population or a particular sex or race."
				Value: 		CodeableConcept from http://hl7.org/fhir/ValueSet/referencerange-appliesto if covered
		
				Element:	ApplicableAgeRange
				Concept:	TBD
				Description:	"The age at which this reference range is applicable. This is a neonatal age (e.g. number of weeks at term) if the meaning says so."  // FHIR: how exactly does one indicate a neonatal or prenatal age?
				Value:		Range

Abstract Element:	CodedNonIndependentFinding
Based on:			NonIndependentFinding
Description:		"A non-independent finding whose result is a concept code."
					FindingResult value is type CodeableConcept
0..0				ReferenceRange					

Abstract Element:	QuantitativeNonIndependentFinding
Based on:			NonIndependentFinding
Description:		"A non-independent finding whose result is a quantity."
					FindingResult value is type Quantity

Abstract Element:	Finding
Based on:		NonIndependentFinding // A Finding has elements that allow it to be independently observed. It's a modeling compromise that allows better mapping. 
Description:	"An assertion, determination, opinion, evaluation, result, observation, or measurement made by a person or device."
0..1			Patient
0..1			Encounter  // findings are often associated with specific encounters
1..1			FindingStatus
0..1			SpecificFocusOfFinding

		Element:		SpecificFocusOfFinding
		Description:	"The specific observed item finding relates to, for example, a related person or condition. The SpecificFocusOfFinding is only required if the thing observed is different than the patient. It should not be an anatomical location. The focus for cancer progression would be the cancer condition. If the property is wound length, the focus would be an instance of a wound. In the case of an assertion of existence, the focus is the larger entity that the asserted item is a portion of. For example, a wound tunnel is part of a wound; an organization part of a larger organization, or an encounter with a hospitalist might be part of a larger hospitalization encounter."
		Value:			ref(InformationItem) // or CodeableConcept or string or CodeableConcept or Identifier 

		Element:		RelevantTime
		Concept:		TBD
		Description:	"The time or time period that the statement addresses.
		The clinically relevant time is not necessarily when the information is gathered or when a test is carried out, but for example, when a specimen was collected, or the time period referred to by the question. Use a TimePeriod for a measurement or specimen collection continued over a significant period of time (e.g. 24 hour Urine Sodium)."
		Value:			dateTime or TimePeriod 

		Element:		FindingMethod
		Concept:		TBD
		Description:	"The technique used to create the finding, for example, the specific imaging technical, lab test code, or assessment vehicle."
		Value:			CodeableConcept

		Element:		FindingStatus
		Concept:		TBD
		Description:	"Indicates whether the finding is preliminary, amended, final, etc."
		Value:			CodeableConcept

EntryElement:	Observation
Based on:		Finding
Concept:		TBD
Description:	"Represents the result of evaluations (measurements, tests, or questions) that have been performed.
Observation has a value representing the result (answer), or an ExceptionValue indicating why the value is not present. The SpecificFocusOfFinding can be the entire patient, or an entity such as a location body structure, intervention, or condition. Things observed about the subject can include social and behavioral factors, subjective and objective observations, and assessments.
For an Observation, the FindingTopicCode describes the aspect or property of the subject being observed or measured. The FindingTopicCode is the 'question code' that pairs to the 'answer' contained in the Value."
0..1			FindingMethod
0..1			RelevantTime
0..*			NonIndependentFinding
				FindingStatus from http://hl7.org/fhir/ValueSet/observation-status
//0..1			DeltaFlag
0..1			Category from http://hl7.org/fhir/ValueSet/observation-category if covered  // MK Category cardinality from 0..* to 0..1 to be compatible with DSTU 2
0..1			AnatomicalLocation
0..1			CommentOrDescription	
0..1			Interpretation
0..1			Device
0..1			PanelMembers

		Element:    	Observer
		Concept:        MTH#C0449416
		Description:    "The person or entity that provided the information in the entry, e.g. the subject (patient), medical professional, family member, device or software program, as distinct from who recorded the entry."
		1..1			ref(EntityOrRole) 
		0..1			RelationshipToPersonOfRecord

		Element:		Interpretation
		Concept:		MTH#C0420833
		Description:	"A clinical interpretation of a finding (applies to both assertions and observation)."
		Value:			CodeableConcept from http://hl7.org/fhir/ValueSet/observation-interpretation if covered

		Element:		PanelMembers
		Concept:		TBD
		Description:	"PanelMembers represent the elements of a group of a related but independent evaluations. 
			Examples are the measurements that compose a complete blood count (CBC), or the elements of a pathology report. Each member is an independent evaluation, but the grouping reflects a composite lab order, shared specimen, or a single report author. Typically the Category and Reason are not given for individual findings that are part of the panel, but rather given at the level of the panel itself."
		0..* 			ref(Observation)

/* commented out but it might need to come back, so please save
		Element:		Precondition
		Concept:		TBD
		Description:	"A description of the conditions or context of an observation, for example, under sedation, fasting or post-exercise. Body position and body site are also qualifiers, but handled separately. A qualifier cannot modify the measurement type; for example, a fasting blood sugar is still a blood sugar. "
		Value:			CodeableConcept or ref(Observation)
*/

		Element:		DeltaFlag
		Concept:		MTH#C1705241
		Description:	"Indicator of significant change (delta) from the last or previous measurement."
		Value:			CodeableConcept from DeltaFlagVS
				
//		Element:		Issued
//		Description:	"The date and time this observation was made available to providers, typically after the results have been reviewed and verified."
//		Value:			instant


//  Non-Laboratory Results

EntryElement:	NonLaboratoryObservation
Based on:		Observation
Description:	"An observation not based on a specimen."

EntryElement:	SimpleNonLaboratoryObservation
Based on:		NonLaboratoryObservation
Description:	"An observation having no components or panel members"
0..0			NonIndependentFinding
0..0			PanelMembers

EntryElement:	CodedNonLaboratoryObservation
Based on:		NonLaboratoryObservation
Concept:		TBD
Description:	"The result of evaluations (measurements, tests, or questions) whose answer is expressed as a code."
				FindingResult value is type CodeableConcept
0..0			ReferenceRange

EntryElement:	SimpleCodedNonLaboratoryObservation
Based on:		CodedNonLaboratoryObservation
Description:	"An observation whose result is a code, and also having no components or panel members"
0..0			NonIndependentFinding
0..0			PanelMembers

EntryElement:	ComponentOnlyNonLaboratoryObservation
Based on:		NonLaboratoryObservation
Description:	"An observation with components, but without a result value or panel members."
0..0			FindingResult
0..0			ExceptionValue
0..0			PanelMembers
0..0			ReferenceRange

// Laboratory Measurements and Results

EntryElement:	LaboratoryObservation
Based on:		Observation
Description:	"A coded finding based on a specimen collected from a patient."
				FindingTopicCode from LaboratoryCodeVS if covered
1..1			Category   // MK changed from 1..* to 1..1 to be compatible with DSTU 2
1..1			Patient
0..1			Specimen
0..0			AnatomicalLocation  // Location is determined indirectly from Specimen.CollectionSite
				Category is OBSCAT#laboratory

EntryElement:	CodedLaboratoryObservation
Based on:		LaboratoryObservation
Description:	"A coded finding from a laboratory test."
				FindingResult value is type CodeableConcept
0..0			ReferenceRange

EntryElement:	SimpleLaboratoryObservation
Based on:		LaboratoryObservation
Description:	"A coded finding from a laboratory test without further panel members or components."
0..0			NonIndependentFinding
0..0			PanelMembers

EntryElement:	SimpleCodedLaboratoryObservation
Based on:		CodedLaboratoryObservation
Description:	"A coded finding from a laboratory test without further panel members or components."
0..0			NonIndependentFinding
0..0			PanelMembers

//---------- Assertions -------------

Abstract Element:	ExistenceAssertion
Based on:			Finding
Description:		"An assertion of a relationship, situation, condition, or other phenomenon is present or absent, or an event has (or has not) taken place.
For assertions, the FindingTopicCode represents the thing asserted to be present or absent; i.e., the type of condition, event, relationship or phenomenon that is being asserted to exist or not exist."
					FindingTopicCode is type ConditionOrDiagnosisCode
					FindingResult is type PresentOrAbsent
// Leave ExceptionValue in, to represent the case where the presence or absence of something was not evaluated
0..0				ReferenceRange
0..1				ObjectIdentifier  // TODO: 0..* business identifier?
//0..1				Certainty
					FindingStatus value is type CodeableConcept

		Element:		ConditionOrDiagnosisCode
		Based on:		FindingTopicCode
		Description:	"A specific code for the condition being determined to be present or absent."
		Value:			CodeableConcept from http://hl7.org/fhir/us/core/ValueSet/us-core-problem if covered  // cannot make the binding weaker because US Core requires an extensible binding

		Element:		PresentOrAbsent
		Based on:		FindingResult
		Description:	"A specific code for the condition being determined to be present or absent."
		Value:			CodeableConcept from PresentAbsentVS

		Element: 		ObjectIdentifier
		Description:	"For later reference, an identifier for the object implied by the assertion, which allows the object to be tracked over time. For example, a wound number is used to track a specific wound's condition over time."
		Value:			Identifier

		Element:		Certainty   // TODO: why not move to Finding?
		Concept:		TBD
		Description:	"The degree of confidence in a conclusion or assertion."
		Value:			CodeableConcept

Abstract Element:	PresenceAssertion
Based on:			ExistenceAssertion
Description:		"Finding that a phenomena is present."
// TODO: Not sure we should have to say .CodeableConcept for the constraint below to work (currently causes error)
1..1				PresentOrAbsent is SCT#52101004 "Present (qualifier value)"
0..0				ExceptionValue	
//0..1				Certainty from PresenceCertaintyVS


Abstract Element:	AbsenceAssertion
Based on:			ExistenceAssertion
Description:		"Finding that an entity, person, role, condition, or phenomenon is absent."
1..1				PresentOrAbsent is SCT#2667000 "Absent (qualifier value)"
0..0				ExceptionValue		
//0..1				Certainty from AbsenceCertaintyVS


EntryElement:	ConditionPresentAssertion
Based on:		PresenceAssertion
Concept:		TBD
Description:	"A condition that is or may be present in a subject. 'Condition' is interpreted broadly and could be a disorder, abnormality, problem, injury, complaint, functionality, illness, disease, ailment, sickness, affliction, upset, difficulty, disorder, symptom, worry, or trouble."
				Metadata.InformationSource value is type ref(PatientOrPractitionerOrRelatedPerson)
1..1			Patient
0..0			SpecificFocusOfFinding  // maybe a family member?
1..1			Category from ConditionCategoryVS   // DSTU 2 change - category is 1..1 in Argonaut
0..*			AnatomicalLocation
1..1			ClinicalStatus from http://hl7.org/fhir/ValueSet/condition-clinical
0..1			Severity from http://hl7.org/fhir/ValueSet/condition-severity
0..1			StageInformation
0..1			Onset
0..1			Abatement   // TODO: change abatement to an Observation
// Stuff from CIMI eliminated
//0..1			FindingMethod
//0..1			WhenClinicallyRecognized
//0..1			PresentOnAdmission
//0..*			ConditionCause
//0..1			Criticality

			Element:		ConditionCause
			Description: "The cause of the condition. This includes such causes as disease vectors and endogenous states (e.g., macular degeneration due to diabetes), substances, medications, micro-organisms, and forces associated with the occurrence of a Condition from temporal or causative perspectives"
			Value:			CodeableConcept or ref(Entity) or ref(Finding)
			// probably other attributes needed, such as likelihood or type of cause

			Element:		ClinicalStatus
			Concept:		TBD
			Description:	"A flag indicating whether the condition is active or inactive, recurring, in remission, or resolved (as of the last update of the Condition)."
			Value:			CodeableConcept

			Element:		WhenClinicallyRecognized
			Concept:		TBD
			Description:	"The time at which a condition or condition was first identified in a healthcare context."
			Value:			date

			Element:		PresentOnAdmission
			Concept:		LNC#89251-3 "Condition present on admission"
			Description:	"If the problem or condition existed before the current episode of care."
			Value:			CodeableConcept from YesNoUnknownVS

			Element:		Severity
			Concept:		MTH#C0392364
			Description:	"Degree of harshness or extent of a symptom, disorder, or condition."
			Value: 			CodeableConcept

			Element:		Criticality
			Concept:		MTH#C3858539 "Criticality"
			Description:	"The potential clinical harm associated with a condition. When the worst case result is assessed to have a life-threatening or organ system threatening potential, it is considered to be of high criticality."
			Value:			CodeableConcept from http://hl7.org/fhir/ValueSet/allergy-intolerance-criticality

			Element:		StageInformation
			Concept:		MTH#C0699749
			Description:	"The relative advancement in the course of a disease. The StageCode is the summary stage or stage group. StageDetail optionally contains the full staging information."
			0..1			StageSummary
			0..1			StageDetail
			
					Element:		StageSummary
					Concept:		TBD
					Description:	"A code representing the current stage of a disease."
					Value:			CodeableConcept

					Element:		StageDetail
					Concept:		TBD
					Description:	"The full staging information"
					Value:			ref(Observation)

			Element:		AlleviatingFactor
			Concept:		LNC#55258-8
			Description:	"Activities that reduce the severity of the pathology"
			Value:			CodeableConcept

			Element:		ExacerbatingFactor
			Concept:		LNC#55258-8
			Description:	"Activities that increase the severity of the pathology"
			Value:			CodeableConcept

			Element:		Onset
			Concept:		LNC#85585-8
			Description:	"The beginning or first appearance of a mental or physical disorder."
			Value:			dateTime or Age or TimePeriod or Range or string
			
			Element:		Abatement
			Concept:		LNC#88878-4
			Description:	"The end, remission or resolution."
			Value:			dateTime or Age or boolean or TimePeriod or Range or string


EntryElement:	ConditionAbsentAssertion
Based on:		AbsenceAssertion
Concept:		MTH#C0277541  "no disease present"
Description:	"A finding that a condition is or was not present in the subject at a certain time or time period, not necessarily the time the information is gathered."
1..*			Category from ConditionCategoryVS
0..*			AnatomicalLocation
				
EntryElement:	ClinicalNote
Based on:		SimpleNonLaboratoryObservation
Concept:		MTH#C0747978 "Progress Note"
Description:	"An entry concerning a patient where the result is a narrative text. While all findings have a CommentOrDescription field, the clinical note should put the narrative in the FindingResult field, since this is the first place to look for a result that is a narrative."
				FindingTopicCode is MTH#C0747978 "Progress Note"
				FindingResult value is type string
0..0			ReferenceRange
1..1			Patient
//1..1			CommentOrDescription // put into FindingResult

EntryElement:	QuestionAnswer
Based on:		SimpleNonLaboratoryObservation
Concept:		TBD
Description:	"A simple question-answer pair. FindingTopicCode should contain the identifying code for the question, and the FindingResult the answer. FindingResult is not constrained because the answer could be a string, concept code, number, etc."
0..0			ReferenceRange
1..1			Patient
0..1			QuestionText

		Element:	QuestionText
		Concept:	TBD
		Description: "The text of the question as it should be asked or is phrased in questionnaire."
		Value:		string


Abstract Element:	RelationshipExistenceAssertion
Based on:			ExistenceAssertion
Description:		"An assertion of a realtionship between two things being either present or absent. The subject of the relationship is is the Patient (or SpecificFocusOfFinding, if given) and the object of the relationship is .
For relationships, FindingTopicCode describes the relationship, e.g., Father or Mother."
Value:				CodeableConcept from PresentAbsentVS


EntryElement:	BodyStructurePresent
Based on:		PresenceAssertion
Description:	"A body structure such as wound or tumor, observed to be present in a patient."
1..1			Patient
0..1			AnatomicalLocationStructured
1..1			Morphology
0..*			Media
0..1			RelevantTime
0..0			SpecificFocusOfFinding
0..0			ReferenceRange
0..0			ExceptionValue

		Element:	Morphology
		Concept:	SCT#116676008 "Associated morphology (attribute)"
		Value:		CodeableConcept